generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ab_experiments {
  id              String           @id
  name            String           @unique
  description     String?
  feature_flag_id String
  is_active       Boolean          @default(true)
  status          ExperimentStatus @default(DRAFT)
  variants        Json
  target_audience String?
  start_date      DateTime?
  end_date        DateTime?
  winner_variant  String?
  metrics         Json?
  created_by_id   String
  created_at      DateTime         @default(now())
  updated_at      DateTime
  users           users            @relation(fields: [created_by_id], references: [id])
  feature_flags   feature_flags    @relation(fields: [feature_flag_id], references: [id], onDelete: Cascade)
  feature_usage   feature_usage[]

  @@index([feature_flag_id])
  @@index([start_date, end_date])
  @@index([status])
}

model achievements {
  id                String              @id
  name              String              @unique
  description       String
  icon              String
  category          String
  points            Int
  criteria          Json
  maxLevel          Int                 @default(1)
  isActive          Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  user_achievements user_achievements[]
}

model audit_logs {
  id        String   @id
  userId    String
  action    String
  target    String?
  targetId  String?
  details   Json?
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id])

  @@index([action])
  @@index([createdAt])
  @@index([userId])
}

model auto_moderation_rules {
  id           String   @id
  name         String
  description  String?
  conditions   Json
  actions      Json
  priority     Int      @default(0)
  isActive     Boolean  @default(true)
  triggerCount Int      @default(0)
  createdBy    String
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  users        users    @relation(fields: [createdBy], references: [id])

  @@index([isActive])
  @@index([priority])
}

model banned_users {
  id                                 String       @id
  userId                             String       @unique
  reason                             String
  bannedBy                           String
  bannedUntil                        DateTime?
  appealStatus                       AppealStatus @default(NONE)
  appealNotes                        String?
  createdAt                          DateTime     @default(now())
  updatedAt                          DateTime
  users_banned_users_bannedByTousers users        @relation("banned_users_bannedByTousers", fields: [bannedBy], references: [id])
  users_banned_users_userIdTousers   users        @relation("banned_users_userIdTousers", fields: [userId], references: [id])

  @@index([appealStatus])
  @@index([bannedUntil])
}

model categories {
  id           String      @id
  community_id String
  name         String
  description  String?
  icon         String?
  position     Int         @default(0)
  is_locked    Boolean     @default(false)
  created_at   DateTime    @default(now())
  communities  communities @relation(fields: [community_id], references: [id], onDelete: Cascade)
  posts        posts[]

  @@unique([community_id, name])
}

model challenges {
  id              String            @id
  name            String
  description     String
  type            ChallengeType
  criteria        Json
  points          Int
  badge           String?
  isActive        Boolean           @default(true)
  startDate       DateTime
  endDate         DateTime
  createdAt       DateTime          @default(now())
  user_challenges user_challenges[]
}

model comments {
  id                String      @id
  post_id           String
  author_id         String
  parent_id         String?
  content           String
  like_count        Int         @default(0)
  created_at        DateTime    @default(now())
  updated_at        DateTime
  deleted_at        DateTime?
  attachments       String[]
  rich_text_content String?
  users             users       @relation(fields: [author_id], references: [id])
  comments          comments?   @relation("commentsTocomments", fields: [parent_id], references: [id])
  other_comments    comments[]  @relation("commentsTocomments")
  posts             posts       @relation(fields: [post_id], references: [id], onDelete: Cascade)
  reactions         reactions[]
}

model communities {
  id                     String                   @id
  name                   String
  slug                   String                   @unique
  description            String?
  logo_url               String?
  cover_url              String?
  is_public              Boolean                  @default(true)
  is_paid                Boolean                  @default(false)
  price_monthly          Float?
  price_yearly           Float?
  currency               String                   @default("USD")
  owner_id               String
  member_count           Int                      @default(0)
  created_at             DateTime                 @default(now())
  updated_at             DateTime
  categories             categories[]
  users                  users                    @relation(fields: [owner_id], references: [id])
  community_members      community_members[]
  courses                courses[]
  events                 events[]
  leaderboards           leaderboards[]
  points                 points[]
  posts                  posts[]
  community_competitions community_competitions[] @relation("CommunityToCommunityCompetition")
}

model community_competitions {
  id          String        @id
  name        String
  description String?
  startDate   DateTime
  endDate     DateTime
  metric      String
  isActive    Boolean       @default(true)
  winnerId    String?
  communities communities[] @relation("CommunityToCommunityCompetition")
}

model community_members {
  id           String      @id
  community_id String
  user_id      String
  role         String      @default("member")
  status       String      @default("active")
  points       Int         @default(0)
  level        Int         @default(1)
  joined_at    DateTime    @default(now())
  communities  communities @relation(fields: [community_id], references: [id], onDelete: Cascade)
  users        users       @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([community_id, user_id])
}

model compliance_checks {
  id        String           @id
  name      String
  type      ComplianceType
  status    ComplianceStatus
  result    Json?
  checkedAt DateTime         @default(now())
  nextCheck DateTime?
  createdAt DateTime         @default(now())
  updatedAt DateTime

  @@index([status])
  @@index([type])
}

model content_filters {
  id        String         @id
  name      String
  type      FilterType
  pattern   String
  severity  FilterSeverity
  action    FilterAction
  isActive  Boolean        @default(true)
  createdBy String
  createdAt DateTime       @default(now())
  updatedAt DateTime
  users     users          @relation(fields: [createdBy], references: [id])

  @@index([isActive])
  @@index([type])
}

model content_flags {
  id          String      @id
  contentId   String
  contentType ContentType
  flagType    FlagType
  severity    Severity
  flaggedById String
  status      FlagStatus  @default(pending)
  createdAt   DateTime    @default(now())
  users       users       @relation(fields: [flaggedById], references: [id], onDelete: Cascade)
}

model conversation_participants {
  id              String        @id
  conversation_id String
  user_id         String
  joined_at       DateTime      @default(now())
  last_read_at    DateTime?
  isAdmin         Boolean       @default(false)
  role            String?
  conversations   conversations @relation(fields: [conversation_id], references: [id], onDelete: Cascade)
  users           users         @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([conversation_id, user_id])
}

model conversations {
  id                        String                      @id
  name                      String?
  created_by                String
  created_at                DateTime                    @default(now())
  updated_at                DateTime
  type                      ConversationType            @default(direct)
  conversation_participants conversation_participants[]
  users                     users                       @relation(fields: [created_by], references: [id])
  messages                  messages[]
}

model course_modules {
  id          String    @id
  course_id   String
  title       String
  description String?
  position    Int       @default(0)
  created_at  DateTime  @default(now())
  courses     courses   @relation(fields: [course_id], references: [id], onDelete: Cascade)
  lessons     lessons[]
}

model courses {
  id               String           @id
  community_id     String
  title            String
  description      String?
  thumbnail        String?
  is_published     Boolean          @default(false)
  position         Int              @default(0)
  created_at       DateTime         @default(now())
  updated_at       DateTime
  currency         String           @default("USD")
  difficulty       CourseDifficulty @default(BEGINNER)
  duration         Int?
  enrollment_count Int              @default(0)
  instructor_id    String
  price            Float            @default(0)
  tags             String[]
  course_modules   course_modules[]
  communities      communities      @relation(fields: [community_id], references: [id], onDelete: Cascade)
  users            users            @relation(fields: [instructor_id], references: [id])
  enrollments      enrollments[]
  user_progress    user_progress[]
}

model customers {
  id               String            @id
  userId           String            @unique
  stripeCustomerId String            @unique
  email            String
  createdAt        DateTime          @default(now())
  updatedAt        DateTime
  users            users             @relation(fields: [userId], references: [id], onDelete: Cascade)
  payment_methods  payment_methods[]
  payments         payments[]
  subscriptions    subscriptions[]
}

model email_queue {
  id         String      @id
  to         String
  subject    String
  html       String
  text       String
  status     EmailStatus @default(PENDING)
  attempts   Int         @default(0)
  error      String?
  sentAt     DateTime?
  created_at DateTime    @default(now())

  @@index([created_at])
  @@index([status])
}

model enrollments {
  id         String    @id
  userId     String
  courseId   String
  paymentId  String?   @unique
  enrolledAt DateTime  @default(now())
  progress   Float     @default(0)
  courses    courses   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  payments   payments? @relation(fields: [paymentId], references: [id])
  users      users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
}

model event_attendees {
  id        String      @id
  event_id  String
  user_id   String
  joined_at DateTime    @default(now())
  status    EventStatus @default(confirmed)
  events    events      @relation(fields: [event_id], references: [id], onDelete: Cascade)
  users     users       @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([event_id, user_id])
}

model event_reminders {
  id         String    @id
  event_id   String
  user_id    String
  remind_at  DateTime
  sent       Boolean   @default(false)
  sent_at    DateTime?
  created_at DateTime  @default(now())
  events     events    @relation(fields: [event_id], references: [id], onDelete: Cascade)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([event_id, user_id, remind_at])
}

model events {
  id              String            @id
  community_id    String
  creator_id      String
  title           String
  description     String?
  location        String?
  meeting_url     String?
  starts_at       DateTime
  ends_at         DateTime
  max_attendees   Int?
  created_at      DateTime          @default(now())
  updated_at      DateTime
  reminders_sent  Boolean           @default(false)
  event_attendees event_attendees[]
  event_reminders event_reminders[]
  communities     communities       @relation(fields: [community_id], references: [id], onDelete: Cascade)
  users           users             @relation(fields: [creator_id], references: [id])
}

model feature_flags {
  id                                       String             @id
  name                                     String             @unique
  key                                      String             @unique
  description                              String?
  value                                    Json
  defaultValue                             Json
  is_active                                Boolean            @default(true)
  is_archived                              Boolean            @default(false)
  rollout_percentage                       Float              @default(100)
  user_ids                                 String[]
  conditions                               Json?
  created_by_id                            String?
  updated_by_id                            String?
  created_at                               DateTime           @default(now())
  updated_at                               DateTime
  archived_at                              DateTime?
  ab_experiments                           ab_experiments[]
  users_feature_flags_created_by_idTousers users?             @relation("feature_flags_created_by_idTousers", fields: [created_by_id], references: [id])
  users_feature_flags_updated_by_idTousers users?             @relation("feature_flags_updated_by_idTousers", fields: [updated_by_id], references: [id])
  feature_segments                         feature_segments[]
  feature_usage                            feature_usage[]
}

model feature_segments {
  id              String        @id
  feature_flag_id String
  name            String
  type            SegmentType
  conditions      Json
  is_active       Boolean       @default(true)
  priority        Int           @default(0)
  created_at      DateTime      @default(now())
  updated_at      DateTime
  feature_flags   feature_flags @relation(fields: [feature_flag_id], references: [id], onDelete: Cascade)

  @@index([feature_flag_id])
  @@index([type])
}

model feature_usage {
  id              String          @id
  user_id         String
  feature_flag_id String?
  experiment_id   String?
  variant         String?
  action          String
  metadata        Json?
  session_id      String?
  user_agent      String?
  ip_address      String?
  timestamp       DateTime        @default(now())
  ab_experiments  ab_experiments? @relation(fields: [experiment_id], references: [id])
  feature_flags   feature_flags?  @relation(fields: [feature_flag_id], references: [id], onDelete: Cascade)
  users           users           @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([action, timestamp])
  @@index([experiment_id])
  @@index([feature_flag_id, timestamp])
  @@index([user_id, timestamp])
}

model file_shares {
  id                                 String    @id
  file_id                            String
  user_id                            String
  shared_by                          String
  status                             String    @default("active")
  expires_at                         DateTime?
  created_at                         DateTime  @default(now())
  updated_at                         DateTime
  files                              files     @relation(fields: [file_id], references: [id], onDelete: Cascade)
  users_file_shares_shared_byTousers users     @relation("file_shares_shared_byTousers", fields: [shared_by], references: [id])
  users_file_shares_user_idTousers   users     @relation("file_shares_user_idTousers", fields: [user_id], references: [id])
}

model files {
  id              String        @id
  user_id         String
  original_name   String
  mime_type       String
  size            Int
  key             String        @unique
  bucket          String
  url             String
  variants        String?
  created_at      DateTime      @default(now())
  updated_at      DateTime
  access_level    String        @default("private")
  cdn_url         String?
  compressed      Boolean       @default(false)
  compressed_size Int?
  deleted_at      DateTime?
  description     String?
  is_public       Boolean       @default(false)
  tags            String[]
  version         Int           @default(1)
  parent_id       String?
  file_shares     file_shares[]
  files           files?        @relation("filesTofiles", fields: [parent_id], references: [id])
  other_files     files[]       @relation("filesTofiles")
  users           users         @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model leaderboards {
  id          String            @id
  communityId String?
  period      LeaderboardPeriod
  startDate   DateTime
  endDate     DateTime
  snapshot    Json
  createdAt   DateTime          @default(now())
  communities communities?      @relation(fields: [communityId], references: [id])

  @@index([communityId, period])
  @@index([startDate, endDate])
}

model lessons {
  id             String          @id
  module_id      String
  title          String
  content_type   String
  content_url    String?
  content_text   String?
  duration       Int?
  position       Int             @default(0)
  is_free        Boolean         @default(false)
  created_at     DateTime        @default(now())
  course_modules course_modules  @relation(fields: [module_id], references: [id], onDelete: Cascade)
  user_progress  user_progress[]
}

model message_reactions {
  id         String   @id
  message_id String
  user_id    String
  type       String   @default("like")
  created_at DateTime @default(now())
  messages   messages @relation(fields: [message_id], references: [id], onDelete: Cascade)
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([message_id, user_id])
}

model messages {
  id                String              @id
  conversation_id   String
  sender_id         String
  content           String
  is_edited         Boolean             @default(false)
  created_at        DateTime            @default(now())
  edited_at         DateTime?
  attachments       String[]
  is_pinned         Boolean             @default(false)
  reactions         Json?
  is_deleted        Boolean             @default(false)
  metadata          Json?
  updated_at        DateTime
  message_type      MessageType         @default(text)
  message_reactions message_reactions[]
  conversations     conversations       @relation(fields: [conversation_id], references: [id], onDelete: Cascade)
  users             users               @relation(fields: [sender_id], references: [id])
}

model moderation_actions {
  id          String               @id
  moderatorId String
  reportId    String
  actionType  ModerationActionType
  reason      String?
  duration    Int?
  createdAt   DateTime             @default(now())
  users       users                @relation(fields: [moderatorId], references: [id])
  reports     reports              @relation(fields: [reportId], references: [id], onDelete: Cascade)
}

model moderation_logs {
  id          String              @id
  targetType  String
  targetId    String
  moderatorId String
  reason      String?
  notes       String?
  metadata    Json?
  createdAt   DateTime            @default(now())
  action      ModerationLogAction
  users       users               @relation(fields: [moderatorId], references: [id])

  @@index([action])
  @@index([moderatorId])
  @@index([targetType, targetId])
}

model notification_preferences {
  id                 String          @id
  user_id            String          @unique
  email_enabled      Boolean         @default(true)
  email_digest       DigestFrequency @default(DAILY)
  email_posts        Boolean         @default(true)
  email_comments     Boolean         @default(true)
  email_messages     Boolean         @default(true)
  email_events       Boolean         @default(true)
  email_courses      Boolean         @default(true)
  push_enabled       Boolean         @default(true)
  push_posts         Boolean         @default(true)
  push_comments      Boolean         @default(true)
  push_messages      Boolean         @default(true)
  push_events        Boolean         @default(true)
  push_courses       Boolean         @default(true)
  in_app_enabled     Boolean         @default(true)
  in_app_sound       Boolean         @default(true)
  created_at         DateTime        @default(now())
  updated_at         DateTime
  dnd_enabled        Boolean         @default(false)
  dnd_end            String?
  dnd_start          String?
  notification_sound String          @default("default.mp3")
  users              users           @relation(fields: [user_id], references: [id])
}

model notifications {
  id         String           @id
  user_id    String
  type       NotificationType
  title      String
  message    String
  data       Json?
  actionUrl  String?
  imageUrl   String?
  read       Boolean          @default(false)
  readAt     DateTime?
  created_at DateTime         @default(now())
  clickedAt  DateTime?
  isClicked  Boolean          @default(false)
  isOpened   Boolean          @default(false)
  openedAt   DateTime?
  users      users            @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([created_at])
  @@index([user_id, read])
}

model payment_methods {
  id                    String    @id
  customerId            String
  stripePaymentMethodId String    @unique
  type                  String
  card                  Json?
  isDefault             Boolean   @default(false)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  customers             customers @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([stripePaymentMethodId])
}

model payments {
  id              String        @id
  customerId      String
  stripePaymentId String        @unique
  amount          Int
  currency        String        @default("usd")
  status          PaymentStatus
  description     String?
  paymentMethodId String?
  courseId        String?
  metadata        Json?
  failureReason   String?
  refunded        Boolean       @default(false)
  refundAmount    Int?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime
  enrollments     enrollments?
  customers       customers     @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([stripePaymentId])
}

model points {
  id          String       @id
  userId      String
  communityId String?
  amount      Int
  type        PointType
  reason      String
  metadata    Json?
  createdAt   DateTime     @default(now())
  communities communities? @relation(fields: [communityId], references: [id])
  users       users        @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([userId, communityId])
}

model posts {
  id                String      @id
  community_id      String
  category_id       String
  author_id         String
  title             String
  content           String
  is_pinned         Boolean     @default(false)
  is_locked         Boolean     @default(false)
  view_count        Int         @default(0)
  like_count        Int         @default(0)
  comment_count     Int         @default(0)
  created_at        DateTime    @default(now())
  updated_at        DateTime
  deleted_at        DateTime?
  attachments       String[]
  rich_text_content String?
  comments          comments[]
  users             users       @relation(fields: [author_id], references: [id])
  categories        categories  @relation(fields: [category_id], references: [id])
  communities       communities @relation(fields: [community_id], references: [id], onDelete: Cascade)
  reactions         reactions[]

  @@index([community_id, created_at])
}

model push_subscriptions {
  id         String   @id
  user_id    String
  endpoint   String   @unique
  keys       Json
  created_at DateTime @default(now())
  users      users    @relation(fields: [user_id], references: [id])

  @@index([user_id])
}

model reactions {
  id         String    @id
  user_id    String
  post_id    String?
  comment_id String?
  type       String    @default("like")
  created_at DateTime  @default(now())
  comments   comments? @relation(fields: [comment_id], references: [id], onDelete: Cascade)
  posts      posts?    @relation(fields: [post_id], references: [id], onDelete: Cascade)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, comment_id])
  @@unique([user_id, post_id])
}

model recommendation_feedback {
  id               String   @id
  userId           String
  recommendationId String
  rating           Int
  comment          String?
  helpful          Boolean?
  createdAt        DateTime @default(now())
  updatedAt        DateTime
  users            users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model reports {
  id                                  String               @id
  reporter_id                         String
  targetType                          String
  targetId                            String
  reason                              ReportReason
  description                         String?
  status                              ReportStatus         @default(PENDING)
  assigned_to                         String?
  reviewed_at                         DateTime?
  reviewed_by_id                      String?
  resolution                          String?
  action                              Json?
  notes                               String?
  created_at                          DateTime             @default(now())
  updated_at                          DateTime
  moderation_actions                  moderation_actions[]
  users_reports_assigned_toTousers    users?               @relation("reports_assigned_toTousers", fields: [assigned_to], references: [id])
  users_reports_reporter_idTousers    users                @relation("reports_reporter_idTousers", fields: [reporter_id], references: [id])
  users_reports_reviewed_by_idTousers users?               @relation("reports_reviewed_by_idTousers", fields: [reviewed_by_id], references: [id])

  @@index([assigned_to])
  @@index([created_at])
  @@index([reporter_id])
  @@index([status])
  @@index([targetType, targetId])
}

model rewards {
  id           String         @id
  name         String         @unique
  description  String?
  type         RewardType
  cost         Int
  stock        Int?
  data         Json?
  is_active    Boolean        @default(true)
  created_at   DateTime       @default(now())
  user_rewards user_rewards[]
}

model search_queries {
  id                  String   @id
  user_id             String?
  query               String
  filters             Json?
  page                Int
  results_count       Int
  took                Int
  clicked_result_id   String?
  clicked_result_type String?
  created_at          DateTime @default(now())
  users               users?   @relation(fields: [user_id], references: [id])

  @@index([created_at])
  @@index([user_id])
}

model streaks {
  id           String     @id
  userId       String
  type         StreakType
  currentDays  Int        @default(0)
  bestDays     Int        @default(0)
  lastActivity DateTime?
  startDate    DateTime   @default(now())
  endDate      DateTime?
  users        users      @relation(fields: [userId], references: [id])

  @@unique([userId, type])
  @@index([userId])
}

model subscriptions {
  id                   String             @id
  customerId           String
  stripeSubscriptionId String             @unique
  stripePriceId        String
  status               SubscriptionStatus
  tier                 SubscriptionTier
  interval             BillingInterval
  currentPeriodStart   DateTime
  currentPeriodEnd     DateTime
  cancelAtPeriodEnd    Boolean            @default(false)
  canceledAt           DateTime?
  trialStart           DateTime?
  trialEnd             DateTime?
  metadata             Json?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime
  customers            customers          @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([stripeSubscriptionId])
}

model user_achievements {
  id            String       @id
  userId        String
  achievementId String
  level         Int          @default(1)
  progress      Int          @default(0)
  unlockedAt    DateTime?
  notified      Boolean      @default(false)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime
  achievements  achievements @relation(fields: [achievementId], references: [id])
  users         users        @relation(fields: [userId], references: [id])

  @@unique([userId, achievementId])
  @@index([userId])
}

model user_challenges {
  id          String     @id
  userId      String
  challengeId String
  progress    Int        @default(0)
  completedAt DateTime?
  challenges  challenges @relation(fields: [challengeId], references: [id])
  users       users      @relation(fields: [userId], references: [id])

  @@unique([userId, challengeId])
}

model user_levels {
  id          String   @id
  userId      String   @unique
  level       Int      @default(1)
  experience  Int      @default(0)
  nextLevelXp Int      @default(100)
  title       String?
  badge       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  users       users    @relation(fields: [userId], references: [id])
}

model user_preferences {
  id                      String   @id
  userId                  String   @unique
  show_leaderboard        Boolean  @default(true)
  email_notifications     Boolean  @default(true)
  push_notifications      Boolean  @default(true)
  created_at              DateTime @default(now())
  updated_at              DateTime
  categories              String[]
  interests               String[]
  optOut                  Boolean  @default(false)
  recommendationFrequency String   @default("weekly")
  users                   users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model user_progress {
  id           String    @id
  user_id      String
  course_id    String
  lesson_id    String?
  progress     Float     @default(0)
  status       String    @default("not_started")
  started_at   DateTime?
  completed_at DateTime?
  created_at   DateTime  @default(now())
  updated_at   DateTime
  courses      courses   @relation(fields: [course_id], references: [id], onDelete: Cascade)
  lessons      lessons?  @relation(fields: [lesson_id], references: [id])
  users        users     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, course_id, lesson_id])
  @@index([user_id, course_id])
}

model user_rewards {
  id        String   @id
  userId    String
  rewardId  String
  createdAt DateTime @default(now())
  rewards   rewards  @relation(fields: [rewardId], references: [id])
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, rewardId])
}

model users {
  id                                               String                      @id
  email                                            String                      @unique
  username                                         String                      @unique
  password_hash                                    String
  first_name                                       String?
  last_name                                        String?
  bio                                              String?
  avatar_url                                       String?
  email_verified                                   Boolean                     @default(false)
  is_active                                        Boolean                     @default(true)
  created_at                                       DateTime                    @default(now())
  updated_at                                       DateTime
  deleted_at                                       DateTime?
  last_active                                      DateTime?
  email_verification_expiry                        DateTime?
  email_verification_token                         String?
  reset_token                                      String?
  reset_token_expiry                               DateTime?
  role                                             UserRole                    @default(USER)
  ab_experiments                                   ab_experiments[]
  audit_logs                                       audit_logs[]
  auto_moderation_rules                            auto_moderation_rules[]
  banned_users_banned_users_bannedByTousers        banned_users[]              @relation("banned_users_bannedByTousers")
  banned_users_banned_users_userIdTousers          banned_users?               @relation("banned_users_userIdTousers")
  comments                                         comments[]
  communities                                      communities[]
  community_members                                community_members[]
  content_filters                                  content_filters[]
  content_flags                                    content_flags[]
  conversation_participants                        conversation_participants[]
  conversations                                    conversations[]
  courses                                          courses[]
  customers                                        customers?
  enrollments                                      enrollments[]
  event_attendees                                  event_attendees[]
  event_reminders                                  event_reminders[]
  events                                           events[]
  feature_flags_feature_flags_created_by_idTousers feature_flags[]             @relation("feature_flags_created_by_idTousers")
  feature_flags_feature_flags_updated_by_idTousers feature_flags[]             @relation("feature_flags_updated_by_idTousers")
  feature_usage                                    feature_usage[]
  file_shares_file_shares_shared_byTousers         file_shares[]               @relation("file_shares_shared_byTousers")
  file_shares_file_shares_user_idTousers           file_shares[]               @relation("file_shares_user_idTousers")
  files                                            files[]
  message_reactions                                message_reactions[]
  messages                                         messages[]
  moderation_actions                               moderation_actions[]
  moderation_logs                                  moderation_logs[]
  notification_preferences                         notification_preferences?
  notifications                                    notifications[]
  points                                           points[]
  posts                                            posts[]
  push_subscriptions                               push_subscriptions[]
  reactions                                        reactions[]
  recommendation_feedback                          recommendation_feedback[]
  reports_reports_assigned_toTousers               reports[]                   @relation("reports_assigned_toTousers")
  reports_reports_reporter_idTousers               reports[]                   @relation("reports_reporter_idTousers")
  reports_reports_reviewed_by_idTousers            reports[]                   @relation("reports_reviewed_by_idTousers")
  search_queries                                   search_queries[]
  streaks                                          streaks[]
  user_achievements                                user_achievements[]
  user_challenges                                  user_challenges[]
  user_levels                                      user_levels?
  user_preferences                                 user_preferences?
  user_progress                                    user_progress[]
  user_rewards                                     user_rewards[]
}

enum AppealStatus {
  NONE
  PENDING
  APPROVED
  DENIED
}

enum BillingInterval {
  DAY
  WEEK
  MONTH
  YEAR
}

enum ChallengeType {
  DAILY
  WEEKLY
}

enum ComplianceStatus {
  PASS
  FAIL
  WARNING
  PENDING
}

enum ComplianceType {
  GDPR
  PCI_DSS
  SOC_2
  ISO_27001
  HIPAA
}

enum ContentType {
  post
  comment
  message
}

enum ConversationType {
  direct
  group
}

enum CourseDifficulty {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum DigestFrequency {
  NEVER
  IMMEDIATELY
  DAILY
  WEEKLY
}

enum EmailStatus {
  PENDING
  SENDING
  SENT
  FAILED
}

enum EventStatus {
  confirmed
  declined
  maybe
}

enum ExperimentStatus {
  DRAFT
  RUNNING
  PAUSED
  COMPLETED
  CANCELLED
}

enum FilterAction {
  FLAG
  BLOCK
  SHADOW_BAN
  REQUIRE_REVIEW
  AUTO_DELETE
}

enum FilterSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum FilterType {
  KEYWORD
  REGEX
  AI_BASED
  IMAGE
  LINK
}

enum FlagStatus {
  pending
  resolved
}

enum FlagType {
  spam
  abuse
  inappropriate
  offtopic
}

enum LeaderboardPeriod {
  DAILY
  WEEKLY
  MONTHLY
  ALL_TIME
}

enum MessageType {
  text
  image
  file
  video
}

enum ModerationActionType {
  WARN
  BAN
  DELETE
  EDIT
  RESTORE
}

enum ModerationLogAction {
  APPROVE
  REJECT
  DELETE
  EDIT
  WARN
  MUTE
  BAN
  UNBAN
  FLAG
  REVIEW
}

enum NotificationType {
  POST_LIKED
  POST_COMMENTED
  POST_MENTIONED
  NEW_MESSAGE
  MESSAGE_REQUEST
  COMMUNITY_INVITE
  COMMUNITY_JOIN_REQUEST
  MEMBER_JOINED
  COURSE_ENROLLED
  LESSON_AVAILABLE
  ASSIGNMENT_GRADED
  CERTIFICATE_EARNED
  EVENT_REMINDER
  EVENT_UPDATED
  EVENT_CANCELLED
  ACHIEVEMENT_UNLOCKED
  LEVEL_UP
  POINTS_EARNED
  LEADERBOARD_RANK
  SYSTEM_ANNOUNCEMENT
  ACCOUNT_UPDATE
  SECURITY_ALERT
}

enum PaymentStatus {
  PENDING
  PROCESSING
  SUCCEEDED
  FAILED
  CANCELED
  REFUNDED
  PARTIALLY_REFUNDED
}

enum PointType {
  POST_CREATED
  POST_LIKED
  COMMENT_CREATED
  COURSE_COMPLETED
  LESSON_COMPLETED
  QUIZ_PASSED
  EVENT_ATTENDED
  DAILY_LOGIN
  STREAK_BONUS
  ACHIEVEMENT_UNLOCKED
  REFERRAL
  CHALLENGE_COMPLETED
  OTHER
}

enum ReportReason {
  SPAM
  HARASSMENT
  INAPPROPRIATE_CONTENT
  VIOLENCE
  HATE_SPEECH
  THREATS
  MISINFORMATION
  COPYRIGHT_INFRINGEMENT
  OTHER
}

enum ReportStatus {
  PENDING
  REVIEWING
  RESOLVED
  DISMISSED
  ESCALATED
}

enum RewardType {
  PROFILE_BADGE
  DISCOUNT_CODE
  EXCLUSIVE_CONTENT
  COURSE_ACCESS
}

enum SegmentType {
  USER_BASED
  ATTRIBUTE_BASED
  BEHAVIOR_BASED
  RANDOM
}

enum Severity {
  low
  medium
  high
}

enum StreakType {
  DAILY_LOGIN
  DAILY_POST
  COURSE_PROGRESS
  CONTRIBUTION
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  INCOMPLETE
  INCOMPLETE_EXPIRED
  PAST_DUE
  TRIALING
  UNPAID
  PAUSED
}

enum SubscriptionTier {
  FREE
  BASIC
  PRO
}

enum UserRole {
  USER
  MODERATOR
  ADMIN
  SUPER_ADMIN
}
